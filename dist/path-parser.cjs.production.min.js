"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tslib"),r=require("search-params"),e=/[^!$'()*+,;|:]/g,n=function(t){return t.replace(e,(function(t){return encodeURIComponent(t)}))},a={default:n,uri:encodeURI,uriComponent:encodeURIComponent,none:function(t){return t},legacy:encodeURI},i={default:decodeURIComponent,uri:decodeURI,uriComponent:decodeURIComponent,none:function(t){return t},legacy:decodeURIComponent},s=function(t,r,e){var i=a[r]||n;return e?String(t).split("/").map(i).join("/"):i(String(t))},u=function(t){return"("+(t?t.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@$]+")+")"},o=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(u(t[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(";"+t[1]+"="+u(t[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(t){return new RegExp("\\"+t[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(t){return new RegExp(t[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(t){return new RegExp(t[0])}}],c=function t(r,e){if(void 0===e&&(e=[]),!o.some((function(n){var a=r.match(n.pattern);return!!a&&(e.push({type:n.name,match:a[0],val:a.slice(1,2),otherVal:a.slice(2),regex:"function"==typeof n.regex?n.regex(a):n.regex}),a[0].length<r.length&&(e=t(r.substr(a[0].length),e)),!0)})))throw new Error("Could not parse path '"+r+"'");return e},p=function(t){return null!=t},l={urlParamsEncoding:"default"};exports.Path=function(){function e(r,e){if(!r)throw new Error("Missing path in Path constructor");this.path=r,this.options=t.__assign(t.__assign({},l),e),this.tokens=c(r),this.hasUrlParams=this.tokens.filter((function(t){return/^url-parameter/.test(t.type)})).length>0,this.hasSpatParam=this.tokens.filter((function(t){return/splat$/.test(t.type)})).length>0,this.hasMatrixParams=this.tokens.filter((function(t){return/matrix$/.test(t.type)})).length>0,this.hasQueryParams=this.tokens.filter((function(t){return/^query-parameter/.test(t.type)})).length>0,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter((function(t){return void 0!==t.regex})).map((function(t){return t.regex.source})).join("")}return e.createPath=function(t,r){return new e(t,r)},e.prototype.isQueryParam=function(t){return-1!==this.queryParams.indexOf(t)},e.prototype.isSpatParam=function(t){return-1!==this.spatParams.indexOf(t)},e.prototype.test=function(e,n){var a=this,i=t.__assign(t.__assign({caseSensitive:!1,strictTrailingSlash:!1},this.options),n),s=function(t,r){return r?t:"\\/"===t?t:t.replace(/\\\/$/,"")+"(?:\\/)?"}(this.source,i.strictTrailingSlash),u=this.urlTest(e,s+(this.hasQueryParams?"(\\?.*$|$)":"$"),i.caseSensitive,i.urlParamsEncoding);if(!u||!this.hasQueryParams)return u;var o=r.parse(e,i.queryParams);return 0===Object.keys(o).filter((function(t){return!a.isQueryParam(t)})).length?(Object.keys(o).forEach((function(t){return u[t]=o[t]})),u):null},e.prototype.partialTest=function(e,n){var a=this,i=t.__assign(t.__assign({caseSensitive:!1,delimited:!0},this.options),n),s=function(t,r){return r?/(\/)$/.test(t)?t:t+"(\\/|\\?|\\.|;|$)":t}(this.source,i.delimited),u=this.urlTest(e,s,i.caseSensitive,i.urlParamsEncoding);if(!u)return u;if(!this.hasQueryParams)return u;var o=r.parse(e,i.queryParams);return Object.keys(o).filter((function(t){return a.isQueryParam(t)})).forEach((function(t){return function(t,r,e){void 0===e&&(e="");var n=t[r];return t[r]=void 0===n?e:Array.isArray(n)?n.concat(e):[n,e],t}(u,t,o[t])})),u},e.prototype.build=function(e,n){var a=this;void 0===e&&(e={});var i=t.__assign(t.__assign({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},this.options),n),o=Object.keys(e).filter((function(t){return!a.isQueryParam(t)})).reduce((function(t,r){if(!p(e[r]))return t;var n=e[r],u=a.isSpatParam(r);return t[r]="boolean"==typeof n?n:Array.isArray(n)?n.map((function(t){return s(t,i.urlParamsEncoding,u)})):s(n,i.urlParamsEncoding,u),t}),{});if(this.urlParams.some((function(t){return!p(e[t])}))){var c=this.urlParams.filter((function(t){return!p(e[t])}));throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+c.join(", ")+" }")}if(!i.ignoreConstraints&&!this.tokens.filter((function(t){return/^url-parameter/.test(t.type)&&!/-splat$/.test(t.type)})).every((function(t){return new RegExp("^"+u(t.otherVal[0])+"$").test(o[t.val])})))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var l=this.tokens.filter((function(t){return!1===/^query-parameter/.test(t.type)})).map((function(t){return"url-parameter-matrix"===t.type?";"+t.val+"="+o[t.val[0]]:/^url-parameter/.test(t.type)?o[t.val[0]]:t.match})).join("");if(i.ignoreSearch)return l;var m=this.queryParams.filter((function(t){return-1!==Object.keys(e).indexOf(t)})).reduce((function(t,r){return t[r]=e[r],t}),{}),h=r.build(m,i.queryParams);return h?l+"?"+h:l},e.prototype.getParams=function(t){return this.tokens.filter("string"!=typeof t?function(r){return t.test(r.type)}:function(r){return r.type===t}).map((function(t){return t.val[0]}))},e.prototype.urlTest=function(t,r,e,n){var a=this,s=new RegExp("^"+r,e?"":"i"),u=t.match(s);return u?this.urlParams.length?u.slice(1,this.urlParams.length+1).reduce((function(t,r,e){return t[a.urlParams[e]]=(i[n]||decodeURIComponent)(r),t}),{}):{}:null},e}();
//# sourceMappingURL=path-parser.cjs.production.min.js.map
